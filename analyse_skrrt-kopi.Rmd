---
title: "analyse_skrrt"
author: "Mille Bryske"
date: "2022-10-26"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
pacman::p_load(tidyverse, readbulk, ggplot2, RColorBrewer, tidyr, lmerTest)
```

```{r}
df_full <- read_bulk("data/vores filer")
```

#Cleaning

```{r}
# Selecting relevant coloumns
df <- df_full %>% 
  select(rt, stimulus, response, exp_id, uddannelse, dysleksi, foerstesprog, books, age, gender)

# Spreading the answers to the second vocabulary test and author recognition test out into separate rows
df <- separate_rows(data = df, response, sep = ",", convert = FALSE)

# Making new coloumns; one with number of question and one with answer given by the participant (basically, we split up the information in the coloumn "response")
df <- df %>%
  mutate(valgmulighed = str_remove_all(response, ":.*|\\..*"))

df <- df %>%
  mutate(svar = str_remove_all(response, ".*:|\\..*"))

# Removing irrelevant text and characters in all coloumns
df <- df %>%
  mutate(valgmulighed = str_remove_all(valgmulighed, "[{]"))

df <- df %>%
  mutate(svar = str_remove_all(svar, "[}]"))

df <- df %>%
  mutate(uddannelse = str_remove_all(uddannelse, ".*:|\\..*"))

df <- df %>%
  mutate(uddannelse = str_remove_all(uddannelse, "[}]"))

df <- df %>%
  mutate(dysleksi = str_remove_all(dysleksi, ".*:|\\..*"))

df <- df %>%
  mutate(dysleksi = str_remove_all(dysleksi, "[}]"))

df <- df %>%
  mutate(foerstesprog = str_remove_all(foerstesprog, ".*:|\\..*"))

df <- df %>%
  mutate(foerstesprog = str_remove_all(foerstesprog, "[}]"))

df <- df %>%
  mutate(books = str_remove_all(books, ".*:|\\..*"))

df <- df %>%
  mutate(books = str_remove_all(books, "[}]"))

df <- df %>%
  mutate(age = str_remove_all(age, ".*:|\\..*"))

df <- df %>%
  mutate(age = str_remove_all(age, "[}]"))

df <- df %>%
  mutate(gender = str_remove_all(gender, ".*:|\\..*"))

df <- df %>%
  mutate(gender = str_remove_all(gender, "[}]"))

# Removing quotation marks in all coloumns
df <- as.data.frame(sapply(df, function(x) gsub("\"", "", x)))

#removing irrelevant rows 
df <- df %>% 
  filter(!grepl('<p>', stimulus)) %>% 
  filter(!grepl('fakultet', valgmulighed)) %>% 
  filter(!grepl('ordblind', valgmulighed)) %>% 
  filter(!grepl('førstesprog', valgmulighed)) %>% 
  filter(!grepl('Q0', valgmulighed)) %>% 
  filter(!grepl('Køn', valgmulighed))

df <- df %>% drop_na()

```

##Adding column for answers with long-ass if-else statement + column indicating sex of author + column indicating the correct answer for author
```{r}
df['accuracy'] <- NA

df$accuracy <- ifelse(df$svar == "gis"|df$svar == "charlatan"|df$svar == "dorsk"|df$svar == "resolut"|df$svar == "reptil"|df$svar == "relikvie"|df$svar == "sololie"|df$svar == "reservat"|df$svar == "istap"|df$svar == "trubadur"|df$svar == "radering"|df$svar == "fjante"|df$svar == "kattun"|df$svar == "halsstarrig"|df$svar == "grif"|df$svar == "dadle"|df$svar == "idelig"|df$svar == "rudel"|df$svar == "sufflør"|df$svar == "prelle"|df$svar == "krill"|df$svar == "spagat"|df$svar == "knibsk"|df$svar == "chalup"|df$svar == "svanger"|df$svar == "dirk"|df$svar == "puld"|df$svar == "rulam"|df$svar == "trappist"|df$svar == "spæge"|df$svar == "chihuahua"|df$svar == "anløben"|df$svar == "skæfte"|df$svar == "klandestin",  1, ifelse(df$stimulus == "audio/forf/Centrifuge.mp3" & df$response == 1 
|df$stimulus == "audio/forf/Krank.mp3" & df$response == 3 
|df$stimulus == "audio/forf/Gobelin.mp3" & df$response == 1
|df$stimulus == "audio/forf/Asiet.mp3" & df$response == 2
|df$stimulus == "audio/forf/Daggert.mp3" & df$response == 2
|df$stimulus == "audio/forf/Longjohn.mp3" & df$response == 3
|df$stimulus == "audio/forf/Chatol.mp3" & df$response == 2
|df$stimulus == "audio/forf/Albatros.mp3" & df$response == 1
|df$stimulus == "audio/forf/Fontaene.mp3" & df$response == 3
|df$stimulus == "audio/forf/Voliere.mp3" & df$response == 0
|df$stimulus == "audio/forf/Unbraconogle.mp3" & df$response == 1
|df$stimulus == "audio/forf/Terrin.mp3" & df$response == 2
|df$stimulus == "audio/forf/Metronom.mp3" & df$response == 1
|df$stimulus == "audio/forf/Gejstlig.mp3" & df$response == 2
|df$stimulus == "audio/forf/Alkymi.mp3" & df$response == 1
|df$stimulus == "audio/forf/Mokkasin.mp3" & df$response == 0
|df$stimulus == "audio/forf/Eufori.mp3" & df$response == 1
|df$stimulus == "audio/forf/Litografi.mp3" & df$response == 3
|df$stimulus == "audio/forf/Cisterne.mp3" & df$response == 1 
|df$stimulus == "audio/forf/Gadekaer.mp3" & df$response == 0 
|df$stimulus == "audio/forf/Lazaret.mp3" & df$response == 1 
|df$stimulus == "audio/forf/Obelisk.mp3" & df$response == 1 
|df$stimulus == "audio/forf/Visir.mp3" & df$response == 1 
|df$stimulus == "audio/forf/Trawler.mp3" & df$response == 1 
|df$stimulus == "audio/forf/Pergola.mp3" & df$response == 2 
|df$stimulus == "audio/forf/Pendel.mp3" & df$response == 3 
|df$stimulus == "audio/forf/Vimpel.mp3" & df$response == 2 
|df$stimulus == "audio/forf/Polio.mp3" & df$response == 3 
|df$stimulus == "audio/forf/Lumbago.mp3" & df$response == 2 
|df$stimulus == "audio/forf/Likvid.mp3" & df$response == 3 
|df$stimulus == "audio/forf/Stramaj.mp3" & df$response == 0 
|df$stimulus == "audio/forf/Skurv.mp3" & df$response == 0, 1, ifelse(df$svar == "Ikke forfatter", 0, ifelse(df$valgmulighed == "Forfatter3" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter5" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter7" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter10" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter12" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter13" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter16" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter18" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter21" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter22" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter24" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter25" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter26" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter28" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter30" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter32" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter35" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter36" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter38" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter40" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter44" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter46" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter47" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter50" & df$svar == "Forfatter"|
df$valgmulighed == "Forfatter52" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter53" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter54" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter55" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter58" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter60" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter62" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter65" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter67" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter69" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter71" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter72" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter74" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter75" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter77" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter80" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter82" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter84" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter87" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter89" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter91" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter93" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter95" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter96" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter98" & df$svar == "Forfatter" |
df$valgmulighed == "Forfatter100" & df$svar == "Forfatter", 1, 
ifelse(df$valgmulighed == "Forfatter1" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter2" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter4" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter6" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter8" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter9" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter11" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter14" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter15" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter17" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter19" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter20" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter23" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter27" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter29" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter31" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter34" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter33" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter37" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter39" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter42" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter43" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter41" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter45" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter48" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter49" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter51" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter56" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter57" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter59" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter61" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter63" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter64" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter66" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter68" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter70" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter73" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter76" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter78" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter79" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter81" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter83" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter85" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter86" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter88" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter90" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter92" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter94" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter97" & df$svar == "Forfatter"|df$valgmulighed == "Forfatter99" & df$svar == "Forfatter", -1, 0)))))


```

```{r}
df['author_sex'] <- NA

df$author_sex <- ifelse(df$valgmulighed == "Forfatter3"|df$valgmulighed == "Forfatter5"|df$valgmulighed == "Forfatter7"|df$valgmulighed == "Forfatter9"|df$valgmulighed == "Forfatter11"|df$valgmulighed == "Forfatter13"|df$valgmulighed == "Forfatter17"|df$valgmulighed == "Forfatter20"|df$valgmulighed == "Forfatter22"|df$valgmulighed == "Forfatter24"|df$valgmulighed == "Forfatter25"|df$valgmulighed == "Forfatter29"|df$valgmulighed == "Forfatter32"|df$valgmulighed == "Forfatter34"|df$valgmulighed == "Forfatter36"|df$valgmulighed == "Forfatter38"|df$valgmulighed == "Forfatter39"|df$valgmulighed == "Forfatter43"|df$valgmulighed == "Forfatter45"|df$valgmulighed == "Forfatter48"|df$valgmulighed == "Forfatter50"|df$valgmulighed == "Forfatter51"|df$valgmulighed == "Forfatter54"|df$valgmulighed == "Forfatter56"|df$valgmulighed == "Forfatter58"|df$valgmulighed == "Forfatter60"|df$valgmulighed == "Forfatter61"|df$valgmulighed == "Forfatter63"|df$valgmulighed == "Forfatter65"|df$valgmulighed == "Forfatter67"|df$valgmulighed == "Forfatter68"|df$valgmulighed == "Forfatter69"|df$valgmulighed == "Forfatter71"|df$valgmulighed == "Forfatter73"|df$valgmulighed == "Forfatter74"|df$valgmulighed == "Forfatter78"|df$valgmulighed == "Forfatter81"|df$valgmulighed == "Forfatter83"|df$valgmulighed == "Forfatter84"|df$valgmulighed == "Forfatter85"|df$valgmulighed == "Forfatter86"|df$valgmulighed == "Forfatter88"|df$valgmulighed == "Forfatter90"|df$valgmulighed == "Forfatter91"|df$valgmulighed == "Forfatter92"|df$valgmulighed == "Forfatter93"|df$valgmulighed == "Forfatter95"|df$valgmulighed == "Forfatter97"|df$valgmulighed == "Forfatter98"|df$valgmulighed == "Forfatter99","kvinde", ifelse(df$valgmulighed == "Forfatter1"|df$valgmulighed == "Forfatter2"|df$valgmulighed == "Forfatter4"|df$valgmulighed == "Forfatter6"|df$valgmulighed == "Forfatter8"|df$valgmulighed == "Forfatter10"|df$valgmulighed == "Forfatter12"|df$valgmulighed == "Forfatter14"|df$valgmulighed == "Forfatter15"|df$valgmulighed == "Forfatter16"|df$valgmulighed == "Forfatter18"|df$valgmulighed == "Forfatter19"|df$valgmulighed == "Forfatter21"|df$valgmulighed == "Forfatter23"|df$valgmulighed == "Forfatter26"|df$valgmulighed == "Forfatter27"|df$valgmulighed == "Forfatter28"|df$valgmulighed == "Forfatter30"|df$valgmulighed == "Forfatter31"|df$valgmulighed == "Forfatter33"|df$valgmulighed == "Forfatter35"|df$valgmulighed == "Forfatter37"|df$valgmulighed == "Forfatter40"|df$valgmulighed == "Forfatter41"|df$valgmulighed == "Forfatter42"|df$valgmulighed == "Forfatter44"|df$valgmulighed == "Forfatter46"|df$valgmulighed == "Forfatter47"|df$valgmulighed == "Forfatter49"|df$valgmulighed == "Forfatter52"|df$valgmulighed == "Forfatter53"|df$valgmulighed == "Forfatter55"|df$valgmulighed == "Forfatter57"|df$valgmulighed == "Forfatter59"|df$valgmulighed == "Forfatter62"|df$valgmulighed == "Forfatter64"|df$valgmulighed == "Forfatter66"|df$valgmulighed == "Forfatter70"|df$valgmulighed == "Forfatter72"|df$valgmulighed == "Forfatter75"|df$valgmulighed == "Forfatter76"|df$valgmulighed == "Forfatter77"|df$valgmulighed == "Forfatter79"|df$valgmulighed == "Forfatter80"|df$valgmulighed == "Forfatter82"|df$valgmulighed == "Forfatter87"|df$valgmulighed == "Forfatter89"|df$valgmulighed == "Forfatter94"|df$valgmulighed == "Forfatter96"|df$valgmulighed == "Forfatter100","mand", NA))


```


###New clean dataframe
```{r}
df_clean <- df %>% 
  select(-c(stimulus, response)) %>% 
  filter(dysleksi == "Nej")

df_clean['trial_type'] <- NA

df_clean$trial_type <- ifelse(df_clean$svar == "Forfatter" | df_clean$svar == "Ikke forfatter", "author_reg", ifelse(df_clean$svar == 0 | df_clean$svar == 1 | df_clean$svar == 2 | df_clean$svar == 3, "m_lyd", "u_lyd"))
```

###Separate dfs for each test and an accuracy df
```{r}
# for (particpant in df_clean) {
#   if (df_clean$trial_type == "author_reg"){
#   group_by(exp_id)}
#   print(sum(accuracy))
#   }

author_reg <- df_clean %>% 
  filter(trial_type == "author_reg")

author_reg$korrekt_svar <- ifelse(author_reg$valgmulighed == "Forfatter3"|author_reg$valgmulighed == "Forfatter5"|author_reg$valgmulighed == "Forfatter7" |author_reg$valgmulighed == "Forfatter10"|author_reg$valgmulighed == "Forfatter12" |author_reg$valgmulighed == "Forfatter13" |author_reg$valgmulighed == "Forfatter16" |author_reg$valgmulighed == "Forfatter18" |author_reg$valgmulighed == "Forfatter21" |author_reg$valgmulighed == "Forfatter22" |author_reg$valgmulighed == "Forfatter24" |author_reg$valgmulighed == "Forfatter25"|author_reg$valgmulighed == "Forfatter26"|author_reg$valgmulighed == "Forfatter28" |author_reg$valgmulighed == "Forfatter30" |author_reg$valgmulighed == "Forfatter32"|author_reg$valgmulighed == "Forfatter35" |author_reg$valgmulighed == "Forfatter36" |author_reg$valgmulighed == "Forfatter38"|author_reg$valgmulighed == "Forfatter40" |author_reg$valgmulighed == "Forfatter44"|author_reg$valgmulighed == "Forfatter46" |author_reg$valgmulighed == "Forfatter47" |author_reg$valgmulighed == "Forfatter50" |
author_reg$valgmulighed == "Forfatter52" |
author_reg$valgmulighed == "Forfatter53" |
author_reg$valgmulighed == "Forfatter54"  |
author_reg$valgmulighed == "Forfatter55"  |
author_reg$valgmulighed == "Forfatter58"  |
author_reg$valgmulighed == "Forfatter60"  |
author_reg$valgmulighed == "Forfatter62"  |
author_reg$valgmulighed == "Forfatter65"  |
author_reg$valgmulighed == "Forfatter67"  |
author_reg$valgmulighed == "Forfatter69"  |
author_reg$valgmulighed == "Forfatter71" |
author_reg$valgmulighed == "Forfatter72" |
author_reg$valgmulighed == "Forfatter74" |
author_reg$valgmulighed == "Forfatter75" |
author_reg$valgmulighed == "Forfatter77"  |
author_reg$valgmulighed == "Forfatter80"  |
author_reg$valgmulighed == "Forfatter82" |
author_reg$valgmulighed == "Forfatter84"  |
author_reg$valgmulighed == "Forfatter87" |
author_reg$valgmulighed == "Forfatter89"  |
author_reg$valgmulighed == "Forfatter91"  |
author_reg$valgmulighed == "Forfatter93"  |
author_reg$valgmulighed == "Forfatter95"  |
author_reg$valgmulighed == "Forfatter96" |
author_reg$valgmulighed == "Forfatter98"  |
author_reg$valgmulighed == "Forfatter100", "Forfatter", "Ikke forfatter")

no_sound <- df_clean %>% 
  filter(trial_type == "u_lyd")

sound <- df_clean %>% 
  filter(trial_type == "m_lyd")

author_acc_by_part <- as.data.frame(aggregate(author_reg$accuracy, by=list(ID=author_reg$exp_id, age=author_reg$age, sex=author_reg$gender, books=author_reg$books, faculty=author_reg$uddannelse), FUN=sum))
sound_acc_by_part <- as.data.frame(aggregate(sound$accuracy, by=list(ID=sound$exp_id), FUN=sum))
no_sound_acc_by_part <- as.data.frame(aggregate(no_sound$accuracy, by=list(ID=no_sound$exp_id), FUN=sum))

accuracy_all <- merge(author_acc_by_part, sound_acc_by_part, by = "ID")
accuracy_all <- merge(accuracy_all, no_sound_acc_by_part, by ="ID")
names(accuracy_all)[6] <- "forfatter"
names(accuracy_all)[7] <- "lydord"
names(accuracy_all)[8] <- "ord"

accuracy_all$total_vocabulary <- accuracy_all$lydord+accuracy_all$ord
accuracy_all$acc_auth_percent <- accuracy_all$forfatter/50*100
accuracy_all$acc_voc_percent <- accuracy_all$total_vocabulary/66*100

accuracy_all <- accuracy_all[order(-accuracy_all$acc_auth_percent),]
```

#Visualizing
##Plotting author recognition vs vocabulary accuracy
```{r}
# ggplot(accuracy_all, aes(x = ID, y = accuracy_in_percent, fill = ))+
#   geom_point(stat = "count")
# 
# accuracy_all <- accuracy_all %>% 
#   pivot_longer(ID, names_to = "", values_to = "count")

cols <- c('red','blue');
ylim <- c(0,100);
par(lwd=6);
barplot(
    t(accuracy_all[c('acc_auth_percent','acc_voc_percent')]),
    beside=T,
    ylim=ylim,
    border=cols,
    col='white',
    xlab='Participant',
    ylab='Percentage correct',
    legend.text=c('Author accuracy','Vocabulary accuracy'),
    args.legend=list(text.col=cols,col=cols,border=cols,bty='n')
);


ggplot(accuracy_all, aes(x = acc_auth_percent, y = acc_voc_percent, color = sex))+
  geom_point()+
  geom_smooth()+
  theme_minimal()+
  labs(x = "Author accuracy", y = "Vocabulary accuracy")

```

##Plotting accurracies separately for the sexes
```{r}
ggplot(accuracy_all, aes(x = sex, y = ord, color = sex))+
  geom_boxplot(width = 0.5)+
  theme_minimal()+
  labs(x = "Gender", y = "Word accuracy")

ggplot(accuracy_all, aes(x = sex, y = lydord, color = sex))+
  geom_boxplot(width = 0.5)+
  theme_minimal()+
  labs(x = "Gender", y = "Sound-word accuracy")

#Merging vocabulary tests
ggplot(accuracy_all, aes(x = sex, y = total_vocabulary, color = sex))+
  geom_boxplot(width = 0.5)+
  theme_minimal()+
  labs(x = "Gender", y = "Vocabulary accuracy")

ggplot(accuracy_all, aes(x = sex, y = forfatter, color = sex))+
  geom_boxplot(width = 0.5)+
  theme_minimal()+
  labs(x = "Gender", y = "Author accuracy")

```

##Plotting accuracy based on age
```{r}
#Color = sex kan bare fjernes for dem alle, hvis det er...

ggplot(accuracy_all, aes(x = age, y = ord, color = sex))+
  geom_point()+
  theme_minimal()+
  labs(x = "Age", y = "Word accuracy")

ggplot(accuracy_all, aes(x = age, y = lydord, color = sex))+
  geom_point()+
  theme_minimal()+
  labs(x = "Age", y = "Sound-word accuracy")

#Merging vocabulary tests
ggplot(accuracy_all, aes(x = age, y = total_vocabulary, color = sex))+
  geom_point()+
  theme_minimal()+
  labs(x = "Age", y = "Vocabulary accuracy")

ggplot(accuracy_all, aes(x = age, y = forfatter, color = sex))+
  geom_point()+
  theme_minimal()+
  labs(x = "Age", y = "Author accuracy")
```

##Plotting accuracy based on books read
```{r}
#Color = sex kan bare fjernes for dem alle, hvis det er...

accuracy_all$books <- as.numeric(accuracy_all$books)

ggplot(accuracy_all, aes(x = books, y = ord, color = sex))+
  geom_point()+
  theme_minimal()+
  labs(x = "Books read", y = "Word accuracy")

ggplot(accuracy_all, aes(x = books, y = lydord, color = sex))+
  geom_point()+
  theme_minimal()+
  labs(x = "Books read", y = "Sound-word accuracy")

#Merging vocabulary tests
ggplot(accuracy_all, aes(x = books, y = total_vocabulary, color = sex))+
  geom_point()+
  theme_minimal()+
  labs(x = "Books read", y = "Vocabulary accuracy")

ggplot(accuracy_all, aes(x = books, y = forfatter, color = sex))+
  geom_point()+
  theme_minimal()+
  labs(x = "Books read", y = "Author accuracy")
```

##Plotting accuracy based on faculty
```{r}
#Color = sex kan bare fjernes for dem alle, hvis det er...

class(accuracy_all$faculty)

ggplot(accuracy_all, aes(x = faculty, y = ord))+
  geom_boxplot(width = 0.5)+
  geom_jitter(aes(x = faculty, color=sex))+ 
  theme_minimal()+
  labs(x = "Faculty", y = "Word accuracy")

ggplot(accuracy_all, aes(x = faculty, y = lydord))+
  geom_boxplot(width = 0.5)+
  geom_jitter(aes(x = faculty, color=sex))+ 
  theme_minimal()+
  labs(x = "Faculty", y = "Sound-word accuracy")

#Merging vocabulary tests
ggplot(accuracy_all, aes(x = faculty, y = total_vocabulary))+
  geom_boxplot(width = 0.5)+
  geom_jitter(aes(x = faculty, color=sex))+ 
  theme_minimal()+
  labs(x = "Faculty", y = "Vocabulary accuracy")

ggplot(accuracy_all, aes(x = faculty, y = forfatter))+
  geom_boxplot(width = 0.5)+
  geom_jitter(aes(x = faculty, color=sex))+ 
  theme_minimal()+
  labs(x = "Faculty", y = "Author accuracy")
```


#Checking for normality (and other assumptions) both visually and numerically
```{r}
#Checking for normality
#ordforråd u. lyd
round(pastecs::stat.desc(accuracy_all$ord, basic = FALSE, norm = TRUE), digits = 2)

ggplot(accuracy_all, aes(x = ord))+
  geom_histogram() +
  theme_minimal()

qqnorm(accuracy_all$ord)

#ordforråd m. lyd
round(pastecs::stat.desc(accuracy_all$lydord, basic = FALSE, norm = TRUE), digits = 2)

ggplot(accuracy_all, aes(x = lydord))+
  geom_histogram() +
  theme_minimal()

qqnorm(accuracy_all$lydord)

#forfattergenkendelse
round(pastecs::stat.desc(accuracy_all$forfatter, basic = FALSE, norm = TRUE), digits = 2)

ggplot(accuracy_all, aes(x = forfatter))+
  geom_histogram() +
  theme_minimal()

qqnorm(accuracy_all$forfatter)

```

##Potentially transforming
```{r}
# Log-transforming
accuracy_all <- accuracy_all %>% 
  mutate(log_forfatter = log(forfatter))

accuracy_all <- accuracy_all %>% 
  mutate(log_ord = log(ord))

accuracy_all <- accuracy_all %>% 
  mutate(log_lydord = log(lydord))

# Checking for normality again
#ordforråd u. lyd
round(pastecs::stat.desc(accuracy_all$log_ord, basic = FALSE, norm = TRUE), digits = 2)
ggplot(accuracy_all, aes(x = log_ord))+
  geom_histogram() +
  theme_minimal()
#ordforråd m. lyd
round(pastecs::stat.desc(accuracy_all$log_lydord, basic = FALSE, norm = TRUE), digits = 2)
ggplot(accuracy_all, aes(x = log_lydord))+
  geom_histogram() +
  theme_minimal()
#forfattergenkendelse
round(pastecs::stat.desc(accuracy_all$log_forfatter, basic = FALSE, norm = TRUE), digits = 2)
ggplot(accuracy_all, aes(x = log_forfatter))+
  geom_histogram() +
  theme_minimal()


```

#Modelling

##Vocabulary accuracy by author accuracy
###The simple stuff: t-test and correlation test
```{r}
#Checking homogeneity of variance 
#Don't know if relevant
bartlett.test(acc_voc_percent ~ acc_auth_percent, data=accuracy_all)

#T-test
# We need an independent samples t-test, which this is, I'm pretty sure
# If the assumption of normality is violated, we need to use WRS2::yuen(x ~ y, data = data) instead
# T-test vil formentlig være ligegyldig. Citat fra Fabio: "Don't bother running a t-test, just do regression!"
t.test(acc_voc_percent ~ acc_auth_percent, data = accuracy_all)

#Pearson's correlation coefficient 
#Both variables should be NORMALLY DISTRIBUTED (test, test test), otherwise use different correlation test, e.g. Spearman (kig uge 41, methods 1)
cor <- cor.test(accuracy_all$acc_voc_percent, accuracy_all$acc_auth_percent, methods = "pearson")
# The correlation coefficient is hard to interpret, so we standardize it by squaring r. This way we get the 'Effect size' which tells us how much of the variance (our data) is explained by our model. 
cor[4]
0.5^2
#Måske det her ikke lige er den helt rigtige måde at gøre det på

```

###Heatmap of correlation
```{r}

#Primært taget fra Mikkels script "forfattergenkendelse_analyse"
pacman::p_load(corrgram, psych)
correlations<-corr.test(accuracy_all[,10:11],method='pearson')
correlations$r
corrgram(correlations$r)

#Caros
library(corrplot)
library(RColorBrewer)
M <-cor(accuracy_all[6:11])
corrplot(M, type="upper", order="hclust",
         col=brewer.pal(n=8, name="RdYlBu"))



#Ellers er der det her fra "Class7_notes"
# pacman::p_load(reshape2)
# 
# #plot as heatmap
# qplot(x=Var1, y=Var2, 
#       data=melt(cor(child, use="p")), 
#       fill=value, 
#       geom="tile") +
#    scale_fill_gradient2(limits=c(-1, 1))
# 
# 
# 
# ##### Highlight only the 'worrying' correlation values
# #plot only values above .7
# plot_df <- melt(cor(child))
# plot_df$value[plot_df$value < 0.7 & plot_df$value > - 0.7] = 0
# qplot(x=Var1, y=Var2, data=plot_df, fill=value, geom="tile") +
#    scale_fill_gradient2(limits=c(-1, 1))
```


###The less simple stuff: making models
```{r}
# Linear regression implies causation (or at least prediction), IS THIS A PROBLEM FOR US?? It's just a correlation study... 

m0 <- lm(acc_voc_percent ~ 0, data = accuracy_all)
m1 <- lm(acc_voc_percent ~ acc_auth_percent, data = accuracy_all)
summary(m1)

#Konceptuelt spørgsmål: skal vi nogensinde bruge random intercept og slopes??
    #Det giver måske mening f.eks. med fakultet, hvis vi tænker, at folk fra forskellige fakulteter konsekvent er forskellige? Men hvorfor så ikke bare sætte det som en predictor?? Vi tænker vel i så fald, det er en systematic variance? 
m2 <- lmer(acc_voc_percent ~ acc_auth_percent + (1|faculty), data = accuracy_all, REML = F) #'REML = F' will allow us to see information criteria for the model (taken from other script)
m3 <- lm(acc_voc_percent ~ acc_auth_percent + faculty, data = accuracy_all)
m4 <- lm(acc_voc_percent ~ acc_auth_percent + books, data = accuracy_all)
m5 <- lm(acc_voc_percent ~ acc_auth_percent + books + faculty, data = accuracy_all)
m6 <- lm(acc_voc_percent ~ acc_auth_percent + books + faculty + sex, data = accuracy_all)
m7 <- lm(acc_voc_percent ~ acc_auth_percent + books + faculty + sex + age, data = accuracy_all)

#Overvej om books skal ud, hvis den ikke er "troværdig"

#Skal vi bruge interactions mellem predictorer?? (* i stedet for +)
m8 <- lm(acc_voc_percent ~ acc_auth_percent + books*faculty, data = accuracy_all) #ikke særlig gennemtænkt eksempel

#ER DET ET PROBLEM AT BRUGE DERES PRÆSTATIONER I PROCENT? Den kan jo aldrig overgå 100, men modellen kan vel godt lave forudsigelser, der er højere? Til gengæld ville den jo heller aldrig kunne overgå hhv. 66 i ordforråd og 100 i forfatter, kan man sige. Er der noget her, der skal gøres? Skal man sætte en nedre og øvre threshold måske?

```

###Comparing models
```{r}
# Check class8_notes

#See adjusted r squared of the models from their summaries
summary(m3)$adj.r.squared

# anova 
anova(m0, m1, m2, m3, m4, m5, m6, m7)

# AIC
AIC(m0, m1, m2, m3, m4, m5, m6, m7)

```

###Testing assumptions on the chosen model
```{r}
### Testing assumptions
m <- aov(formula = acc_voc_percent ~ acc_auth_percent, data = accuracy_all)
#Put chosen model here

# Linearity of residuals
plot(m, 1, main = 2.1, col.main = 'red')

# Normality of residuals
plot(m, 2, main = 2.2, col.main = 'red')

# Homoschedasticity
plot(m, 3, main = 2.3, col.main = 'red')
#car::leveneTest(acc_voc_percent ~ acc_auth_percent, accuracy_all)

# Influential cases
plot(m, 4, main = 2.4, col.main = 'red')

# Independence of residuals
car::durbinWatsonTest(model)

```


###Post-hoc comparison??? I don't think so, since we are doing linear regression instead of using aov()
```{r}
# The lines below are from my notes to the lecture in week 45 on methods 1

#In this example we've got significant results (from a test comparing means with aov()), meaning that somewhere there's a difference in means between groups. BUT we don't know where, so you got to analyze that afterwards. You do that with a post-hoc comparison with corrections

#When you know regression, then ANOVA (aov()) isn't really useful for anything !!!
  #BESIDES: you can use anova() to compare models and pick the best one
#One-way anova is like linear regression, two-way anova is like when you have two predictors etc.
```


##Skal vi modellere accuracy ~ books + fakultet + age + sex (alt efter hvilke der giver mening) for både forfatter og ordforråd??? For selv hvis acc_auth ikke kan predicte acc_voc, så kan det være, at vi stadig kan opdage en anden sjov korrelation
```{r}
#Kun ordforråd uden lyd
o_acc <- lm(ord ~ faculty, data = accuracy_all)
o_acc2 <- lm(ord ~ books, data = accuracy_all)
o_acc3 <- lm(ord ~ faculty + sex, data = accuracy_all)
o_acc4 <- lm(ord ~ faculty + sex + age, data = accuracy_all)
#Prøv også gerne med andre sammensætninger

#Kun lydord
l_acc <- lm(lydord ~ faculty, data = accuracy_all)
l_acc2 <- lm(lydord ~ books, data = accuracy_all)
l_acc3 <- lm(lydord ~ faculty + sex, data = accuracy_all)
l_acc4 <- lm(lydord ~ faculty + sex + age, data = accuracy_all)

#Begge ordforråd (i procent accuracy)
voc_acc <- lm(acc_voc_percent ~ faculty, data = accuracy_all)
voc_acc2 <- lm(acc_voc_percent ~ books, data = accuracy_all)
voc_acc3 <- lm(acc_voc_percent ~ faculty + sex, data = accuracy_all)
voc_acc4 <- lm(acc_voc_percent ~ faculty + sex + age, data = accuracy_all)

#Forfattergenkendelse (i procent accuracy)
for_acc <- lm(acc_auth_percent ~ faculty, data = accuracy_all)
for_acc2 <- lm(acc_auth_percent ~ books, data = accuracy_all)
for_acc3 <- lm(acc_auth_percent ~ faculty + sex, data = accuracy_all)
for_acc4 <- lm(acc_auth_percent ~ faculty + sex + age, data = accuracy_all)


#Skal vi bruge den store df (df_clean) nogensinde, så det er repeated measures??? 
#Tror det sgu faktisk ikke... 

#Skal vi bruge interactions mellem predictorer?? (* i stedet for +)


```

###Comparing models
```{r}

```


#Undersøg, om der er nogle navne, der aldrig bliver ramt + om der er nogle navne, som alle rammer
##Lav ny df
```{r}
author_hits <- author_reg

# Making a new accuracy column, where hits and correct rejections give 1, and misses and false alarm give 0
author_hits$hitmiss <- ifelse(author_hits$svar == "Forfatter" & author_hits$korrekt_svar == "Forfatter" | author_hits$svar == "Ikke forfatter" & author_hits$korrekt_svar == "Ikke forfatter", 1, 0)

# Summing
author_hits <- as.data.frame(aggregate(author_hits$hitmiss, by=list(forfatter=author_hits$valgmulighed, korrekt=author_hits$korrekt_svar, køn=author_hits$author_sex), FUN=sum))
names(author_hits)[4] <- "summed_acc"


# This (the limes below) ended up being irrelevant since the plot still didn't look intuitive

# Make a new coloum where I remove "Forfatter" to make the column 'forfatter' numeric and then ordering the dataframe after the number of the author
author_hits$forfatternummer <- author_hits$forfatter
author_hits$forfatternummer<-gsub("Forfatter","", as.character(author_hits$forfatternummer))
author_hits$forfatternummer <- as.numeric(author_hits$forfatternummer)
author_hits <- author_hits[order(author_hits$forfatternummer),]


```

##Visualize
```{r}
# This is not super intuitive because the authors should have had numbers from 1-50 and 51-100 for the x-axes to be more meaningful
ggplot(author_hits, aes(x = forfatter, y = summed_acc, fill = køn))+
  geom_col(aes(x=forfatter), color ="dark grey")+
  #geom_jitter(aes(x = Pclass, color=Sex , shape = Survived))+ 
  #scale_shape_manual(values = c(3,19))+
  facet_grid(cols = vars(korrekt))+
  labs(title = "Which authors are recognized", x = "Authors", y = "Accuracy")+
  theme_minimal()

# Instead I just split the dataframe and plot two different plots
author_hits_forfattere <- author_hits %>% 
  filter(korrekt == "Forfatter")
author_hits_forfattere$forfatternummer <- c(1:50)
  
author_hits_ikkeforfattere <- author_hits %>% 
  filter(korrekt == "Ikke forfatter")
author_hits_ikkeforfattere$forfatternummer <- c(1:50)

ggplot(author_hits_forfattere, aes(x = forfatternummer, y = summed_acc, fill = køn))+
  geom_col(aes(x=forfatternummer), color ="dark grey")+
  #geom_jitter(aes(x = Pclass, color=Sex , shape = Survived))+ 
  #scale_shape_manual(values = c(3,19))+
  #facet_grid(cols = vars(korrekt))+
  labs(title = "Which authors are correctly identified", x = "Authors", y = "Accuracy")+
  theme_minimal()

ggplot(author_hits_ikkeforfattere, aes(x = forfatternummer, y = summed_acc, fill = køn))+
  geom_col(aes(x=forfatternummer), color ="dark grey")+
  #geom_jitter(aes(x = Pclass, color=Sex , shape = Survived))+ 
  #scale_shape_manual(values = c(3,19))+
  #facet_grid(cols = vars(korrekt))+
  labs(title = "Which non-authors are correctly identified", x = "Authors", y = "Accuracy")+
  theme_minimal()

```

##T-test: author recognition by the sex of the author
```{r}
#Checking homogeneity of variance 
#Don't know if relevant
bartlett.test(summed_acc ~ køn, data=author_hits)

#T-test
t.test(summed_acc ~ køn, data = author_hits)

#Linear regression
summary(lm(summed_acc ~ køn, data = author_hits))

```

Andre sjove spørsgmål, man kunne stille:
- Er nogen (f.eks. køn eller fakultet) mere tilbøjelige til at være "modige" med at svare Forfatter?
- Er der et own-gender bias? Altså svarer kvinder oftere at kvinder er forfattere og omvendt? 
